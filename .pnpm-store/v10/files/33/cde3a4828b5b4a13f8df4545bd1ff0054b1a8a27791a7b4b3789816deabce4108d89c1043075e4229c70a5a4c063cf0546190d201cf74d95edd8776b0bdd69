"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MonorepoTsProject = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/*! Copyright [Amazon.com](http://amazon.com/), Inc. or its affiliates. All Rights Reserved.
SPDX-License-Identifier: Apache-2.0 */
const path = require("path");
const projen_1 = require("projen");
const javascript_1 = require("projen/lib/javascript");
const typescript_1 = require("projen/lib/typescript");
const syncpack_options_1 = require("./syncpack-options");
const nx_configurator_1 = require("../../components/nx-configurator");
const nx_project_1 = require("../../components/nx-project");
const projen_dependency_1 = require("../../components/projen-dependency");
const utils_1 = require("../../utils");
/**
 * This project type will bootstrap a monorepo with support for polygot
 * builds, build caching, dependency graph visualization and much more.
 *
 * @pjid monorepo-ts
 */
class MonorepoTsProject extends typescript_1.TypeScriptProject {
    constructor(options) {
        const defaultReleaseBranch = options.defaultReleaseBranch ?? "main";
        super({
            ...options,
            github: options.github ?? false,
            package: options.package ?? false,
            projenCommand: options.packageManager
                ? utils_1.NodePackageUtils.command.projen(options.packageManager)
                : undefined,
            prettier: options.prettier ?? true,
            projenrcTs: true,
            release: options.release ?? false,
            jest: options.jest ?? false,
            sampleCode: false, // root should never have sample code,
            gitignore: [".tmp", ...(options.gitignore ?? [])],
            defaultReleaseBranch,
            eslintOptions: options.eslintOptions ?? {
                dirs: ["."],
                ignorePatterns: ["packages/**/*.*"],
            },
            tsconfig: options.tsconfig ?? {
                compilerOptions: {
                    rootDir: ".",
                },
                include: ["**/*.ts", ".projenrc.ts"],
            },
            peerDeps: ["nx@^19", ...(options.peerDeps || [])],
            devDeps: ["nx@^19", "@aws/pdk@^0", ...(options.devDeps || [])],
            deps: [
                "aws-cdk-lib",
                "cdk-nag",
                "@aws-cdk/aws-cognito-identitypool-alpha@latest",
                ...(options.deps || []),
            ],
            projenVersion: options.projenVersion ?? projen_dependency_1.DEFAULT_PROJEN_VERSION,
        });
        this.subNodeProjectResolves = [];
        this.projenVersion = options.projenVersion ?? projen_dependency_1.DEFAULT_PROJEN_VERSION;
        this.nxConfigurator = new nx_configurator_1.NxConfigurator(this, {
            defaultReleaseBranch,
            licenseOptions: options.licenseOptions,
        });
        this._options = options;
        // engines
        this.package.addEngine("node", ">=16");
        this.package.setScript("install:ci", !this.ejected
            ? utils_1.NodePackageUtils.command.exec(this.package.packageManager, "projen install:ci")
            : "scripts/run-task install:ci");
        switch (this.package.packageManager) {
            case javascript_1.NodePackageManager.BUN: {
                this.package.addEngine("bun", ">=1");
                break;
            }
            case javascript_1.NodePackageManager.PNPM: {
                // https://pnpm.io/package_json
                this.package.addEngine("pnpm", ">=8");
                break;
            }
            case javascript_1.NodePackageManager.YARN_CLASSIC:
            case javascript_1.NodePackageManager.YARN: {
                this.package.addEngine("yarn", ">=1 <2");
                break;
            }
            case javascript_1.NodePackageManager.YARN_BERRY:
            case javascript_1.NodePackageManager.YARN2: {
                this.package.addEngine("yarn", ">=2");
                // Yarn Berry cannot call yarn exec without an install first! Use NPX instead.
                this.package.setScript("install:ci", !this.ejected
                    ? utils_1.NodePackageUtils.command.exec(javascript_1.NodePackageManager.NPM, "projen install:ci")
                    : "scripts/run-task install:ci");
                this.package.setScript("install", !this.ejected
                    ? utils_1.NodePackageUtils.command.exec(javascript_1.NodePackageManager.NPM, "projen install")
                    : "scripts/run-task install");
                this.gitignore.addPatterns(".yarn/*", ".pnp.cjs", "!.yarn/releases", "!.yarn/plugins");
                break;
            }
            case javascript_1.NodePackageManager.NPM: {
                // Allow older versions of peer deps to resolv compatibility issues
                this.tasks.tryFind("install")?.reset("npm install --legacy-peer-deps");
                this.tasks.tryFind("install:ci")?.reset("npm ci --legacy-peer-deps");
                break;
            }
        }
        this.workspaceConfig = options.workspaceConfig;
        this.workspacePackages = options.workspaceConfig?.additionalPackages ?? [];
        // Never publish a monorepo root package.
        this.package.addField("private", true);
        // Add alias task for "projen" to synthesize workspace
        !this.ejected &&
            this.package.setScript("synth-workspace", utils_1.NodePackageUtils.command.projen(this.package.packageManager));
        // Map tasks to nx run-many
        if (options.scripts == null || options.scripts.build == null) {
            this.nxConfigurator._overrideNxBuildTask(this.buildTask, { target: "build" }, { force: true });
        }
        if (options.scripts == null || options.scripts["pre-compile"] == null) {
            this.nxConfigurator._overrideNxBuildTask(this.preCompileTask, {
                target: "pre-compile",
            });
        }
        if (options.scripts == null || options.scripts.compile == null) {
            this.nxConfigurator._overrideNxBuildTask(this.compileTask, {
                target: "compile",
            });
        }
        if (options.scripts == null || options.scripts["post-compile"] == null) {
            this.nxConfigurator._overrideNxBuildTask(this.postCompileTask, {
                target: "post-compile",
            });
        }
        if (options.scripts == null || options.scripts.test == null) {
            this.nxConfigurator._overrideNxBuildTask(this.testTask, {
                target: "test",
            });
        }
        if (options.scripts == null || options.scripts.eslint == null) {
            // The Projenrc component of TypeScriptProject resets the eslint task as part of preSynthesize which would undo
            // our changes, so we disable further resets.
            this.nxConfigurator._overrideNxBuildTask(this.eslint?.eslintTask, { target: "eslint" }, { disableReset: true });
        }
        if (options.scripts == null || options.scripts.package == null) {
            this.nxConfigurator._overrideNxBuildTask(this.packageTask, {
                target: "package",
            });
        }
        if (options.scripts == null || options.scripts.prepare == null) {
            this.nxConfigurator._overrideNxBuildTask("prepare", {
                target: "prepare",
            });
        }
        if (options.scripts == null || options.scripts.watch == null) {
            this.nxConfigurator._overrideNxBuildTask(this.watchTask, {
                target: "watch",
                noBail: false,
                ignoreCycles: true,
                skipCache: true,
                outputStyle: "stream",
            });
        }
        this.package.addPackageResolutions("@types/babel__traverse@7.18.2", "wrap-ansi@^7.0.0");
        if (this.package.packageManager !== javascript_1.NodePackageManager.BUN) {
            this.package.addPackageResolutions("@zkochan/js-yaml@npm:js-yaml@4.1.0");
        }
    }
    /**
     * @inheritdoc
     */
    get nx() {
        return this.nxConfigurator.nx;
    }
    /**
     * @inheritdoc
     */
    execNxRunManyCommand(options) {
        return this.nxConfigurator.execNxRunManyCommand(options);
    }
    /**
     * @inheritdoc
     */
    composeNxRunManyCommand(options) {
        return this.nxConfigurator.composeNxRunManyCommand(options);
    }
    /**
     * @inheritdoc
     */
    addNxRunManyTask(name, options) {
        return this.nxConfigurator.addNxRunManyTask(name, options);
    }
    /**
     * @inheritdoc
     */
    addImplicitDependency(dependent, dependee) {
        this.nxConfigurator.addImplicitDependency(dependent, dependee);
    }
    /**
     * @inheritdoc
     */
    addJavaDependency(dependent, dependee) {
        this.nxConfigurator.addJavaDependency(dependent, dependee);
    }
    /**
     * @inheritdoc
     */
    addPythonPoetryDependency(dependent, dependee) {
        this.nxConfigurator.addPythonPoetryDependency(dependent, dependee);
    }
    /**
     * Add one or more additional package globs to the workspace.
     * @param packageGlobs paths to the package to include in the workspace (for example packages/my-package)
     */
    addWorkspacePackages(...packageGlobs) {
        // Any subprojects that were added since the last call to this method need to be added first, in order to ensure
        // we add the workspace packages in a sane order.
        const relativeSubProjectWorkspacePackages = this.sortedSubProjects
            .filter((s) => utils_1.ProjectUtils.isNamedInstanceOf(s, javascript_1.NodeProject))
            .map((project) => path.relative(this.outdir, project.outdir));
        const existingWorkspacePackages = new Set(this.workspacePackages);
        this.workspacePackages.push(...relativeSubProjectWorkspacePackages.filter((pkg) => !existingWorkspacePackages.has(pkg)));
        // Add the additional packages next
        this.workspacePackages.push(...packageGlobs);
    }
    /** Get consistently sorted list of subprojects */
    get sortedSubProjects() {
        return this.subprojects
            .slice()
            .sort((a, b) => a.name.localeCompare(b.name));
    }
    /**
     * Create symbolic links to all local workspace bins. This enables the usage of bins the same
     * way as consumers of the packages have when installing from the registry.
     */
    linkLocalWorkspaceBins() {
        const bins = [];
        this.subprojects.forEach((subProject) => {
            if (utils_1.ProjectUtils.isNamedInstanceOf(subProject, javascript_1.NodeProject) &&
                subProject.name !== "@aws/pdk") {
                const pkgBins = subProject.package.manifest.bin() || {};
                bins.push(...Object.entries(pkgBins).map(([cmd, bin]) => {
                    const resolvedBin = path.join("$PWD", path.relative(this.outdir, subProject.outdir), bin);
                    return [cmd, resolvedBin];
                }));
            }
        });
        const linkTask = this.addTask("workspace:bin:link", {
            steps: bins.map(([cmd, bin]) => ({
                exec: `ln -s ${bin} ${utils_1.NodePackageUtils.command.bin(this.package.packageManager, cmd)} &>/dev/null; exit 0;`,
            })),
        });
        (this.tasks.tryFind("prepare") || this.addTask("prepare")).spawn(linkTask);
    }
    addUpgradeDepsTask() {
        if (this._options.monorepoUpgradeDeps !== false) {
            this.addDevDeps("npm-check-updates", "syncpack@^13");
            const upgradeDepsTask = this.addTask(this._options.monorepoUpgradeDepsOptions?.taskName || "upgrade-deps", {
                description: "Upgrade dependencies in the monorepo",
            });
            // Run the upgrade task for any non-node subprojects
            const nonNodeSubprojects = this.subprojects.filter((p) => !utils_1.NodePackageUtils.isNodeProject(p));
            if (nonNodeSubprojects.length > 0) {
                this.nxConfigurator._overrideNxBuildTask(upgradeDepsTask, {
                    target: "upgrade",
                    projects: nonNodeSubprojects.map((p) => p.name),
                });
            }
            this.nxConfigurator._configurePythonSubprojectUpgradeDeps(this, upgradeDepsTask);
            // Upgrade node subprojects together
            upgradeDepsTask.exec(utils_1.NodePackageUtils.command.exec(this.package.packageManager, "npm-check-updates", "--reject projen", "--deep", "--rejectVersion", "0.0.0", "-u", "--dep", "prod,dev,peer,optional,bundle", "--target=minor"));
            // Sync dependency versions across node subprojects
            upgradeDepsTask.exec(utils_1.NodePackageUtils.command.exec(this.package.packageManager, "syncpack", "fix-mismatches"));
            upgradeDepsTask.exec(`rm ${this.package.lockFile}`);
            upgradeDepsTask.exec(utils_1.NodePackageUtils.command.install(this.package.packageManager));
            !this.ejected &&
                upgradeDepsTask.exec(utils_1.NodePackageUtils.command.exec(this.package.packageManager, "projen"));
            new projen_1.JsonFile(this, ".syncpackrc.json", {
                obj: this._options.monorepoUpgradeDepsOptions?.syncpackConfig ||
                    syncpack_options_1.Syncpack.DEFAULT_CONFIG,
                readonly: true,
            });
        }
    }
    preSynthesize() {
        this.addUpgradeDepsTask();
        utils_1.NodePackageUtils.removeProjenScript(this);
        this.nxConfigurator.preSynthesize();
        super.preSynthesize();
        if (this._options.workspaceConfig?.linkLocalWorkspaceBins === true) {
            this.linkLocalWorkspaceBins();
        }
        this.subprojects.forEach((subProject) => {
            if (utils_1.NodePackageUtils.isNodeProject(subProject)) {
                // Remove any subproject .npmrc files since only the root one matters
                subProject.tryRemoveFile(".npmrc");
                utils_1.NodePackageUtils.removeProjenScript(subProject);
            }
        });
        (0, projen_dependency_1.syncProjenVersions)(this.subprojects, this.projenVersion);
    }
    /**
     * @inheritDoc
     */
    synth() {
        this.validateSubProjects();
        this.updateWorkspace();
        this.installNonNodeDependencies();
        this.resolveLocalBunDependencies();
        // Disable node warnings if configured
        if (this._options.disableNodeWarnings) {
            this.disableNodeWarnings();
        }
        // Prevent sub NodeProject packages from `postSynthesis` which will cause individual/extraneous installs.
        // The workspace package install will handle all the sub NodeProject packages automatically.
        this.subprojects.forEach((subProject) => {
            if (utils_1.NodePackageUtils.isNodeProject(subProject)) {
                const subNodeProject = subProject;
                const subNodeProjectResolver = 
                // @ts-ignore - `resolveDepsAndWritePackageJson` is private
                subNodeProject.package.resolveDepsAndWritePackageJson;
                // @ts-ignore - `installDependencies` is private
                subNodeProject.package.installDependencies = () => {
                    this.subNodeProjectResolves.push(() => subNodeProjectResolver.apply(subNodeProject.package));
                };
                // @ts-ignore - `resolveDepsAndWritePackageJson` is private
                subNodeProject.package.resolveDepsAndWritePackageJson = () => { };
            }
        });
        this.nxConfigurator.synth();
        super.synth();
    }
    /**
     * @inheritDoc
     */
    postSynthesize() {
        super.postSynthesize();
        this.resolveSubNodeProjects();
    }
    /**
     * Resolve sub `NodePackage` dependencies.
     */
    resolveSubNodeProjects() {
        if (this.subNodeProjectResolves.length) {
            if (!this.package.file.changed) {
                // Force workspace install deps since it would not have been invoked during `postSynthesis`.
                // @ts-ignore - `installDependencies` is private
                this.package.installDependencies();
            }
            const completedResolves = this.subNodeProjectResolves.map((resolve) => resolve());
            if (completedResolves.some(Boolean)) {
                // Indicates that a subproject dependency has been resolved from '*', so update the lockfile.
                // @ts-ignore - `installDependencies` is private
                this.package.installDependencies();
            }
        }
        this.subNodeProjectResolves = [];
    }
    /**
     * Ensures subprojects don't have a default task and that all packages use the same package manager.
     */
    validateSubProjects() {
        this.subprojects.forEach((subProject) => {
            // Disable default task on subprojects as this isn't supported in a monorepo
            subProject.defaultTask?.reset();
            if (utils_1.NodePackageUtils.isNodeProject(subProject) &&
                subProject.package.packageManager !== this.package.packageManager) {
                throw new Error(`${subProject.name} packageManager does not match the monorepo packageManager: ${this.package.packageManager}.`);
            }
        });
    }
    /**
     * Add a submodule entry to the appropriate workspace file.
     */
    updateWorkspace() {
        // A final call to addWorkspacePackages will update the list of workspace packages with any subprojects that have
        // not yet been added, in the correct order
        this.addWorkspacePackages();
        let noHoist = this.workspaceConfig?.yarn?.noHoist;
        // Automatically add all sub-project "bundledDependencies" to workspace "hohoist", otherwise they are not bundled in npm package
        if (this.workspaceConfig?.yarn?.disableNoHoistBundled !== true &&
            [
                javascript_1.NodePackageManager.YARN,
                javascript_1.NodePackageManager.YARN2,
                javascript_1.NodePackageManager.YARN_BERRY,
                javascript_1.NodePackageManager.YARN_CLASSIC,
            ].includes(this.package.packageManager)) {
            const noHoistBundled = this.subprojects.flatMap((sub) => {
                if (utils_1.ProjectUtils.isNamedInstanceOf(sub, javascript_1.NodeProject)) {
                    return getBundledDeps(sub).flatMap((dep) => [
                        `${sub.name}/${dep.name}`,
                        `${sub.name}/${dep.name}/*`,
                    ]);
                }
                return [];
            });
            if (noHoistBundled.length) {
                noHoist = [...(noHoist || []), ...noHoistBundled];
            }
        }
        // Add workspaces for each subproject
        if (this.package.packageManager === javascript_1.NodePackageManager.PNPM) {
            new projen_1.YamlFile(this, "pnpm-workspace.yaml", {
                readonly: true,
                obj: {
                    packages: this.workspacePackages,
                },
            });
        }
        this.package.addField("workspaces", {
            packages: this.workspacePackages,
            nohoist: noHoist,
        });
    }
    /**
     * Ensures the install task for non-node projects is executed postinstall.
     *
     * @private
     */
    installNonNodeDependencies() {
        const installProjects = this.subprojects.filter((project) => !utils_1.ProjectUtils.isNamedInstanceOf(project, javascript_1.NodeProject) &&
            project.tasks.tryFind("install"));
        if (installProjects.length > 0) {
            // TODO: Install error on clean repo for postinstall (https://cloud.nx.app/runs/MptQr0BxgF) (https://github.com/nrwl/nx/issues/11210)
            const postinstallTask = this.tasks.tryFind("postinstall") ?? this.addTask("postinstall");
            const nxRunManyInstall = this.composeNxRunManyCommand({
                target: "install",
                projects: installProjects.map((project) => project.name),
                parallel: 1,
            });
            postinstallTask.exec(utils_1.NodePackageUtils.command.exec(this.package.packageManager, ...nxRunManyInstall));
            // Ensure that install-py follows dependency order
            installProjects.forEach((p) => {
                nx_project_1.NxProject.ensure(p).setTarget("install", {
                    dependsOn: ["^install"],
                });
            });
        }
    }
    /**
     * Suppress Node warnings from being presented in the console when running builds.
     */
    disableNodeWarnings() {
        this.tasks.addEnvironment("NODE_NO_WARNINGS", "1");
        this.subprojects.forEach((subProject) => subProject.tasks.addEnvironment("NODE_NO_WARNINGS", "1"));
    }
    /**
     * Resolve all local workspace dependencies to keep bun happy.
     */
    resolveLocalBunDependencies() {
        if (this.package.packageManager !== javascript_1.NodePackageManager.BUN) {
            return;
        }
        const nodeSubProjectNames = new Set(this.subprojects
            .filter((s) => utils_1.NodePackageUtils.isNodeProject(s))
            .map((s) => s.package.packageName));
        this.subprojects.forEach((subProject) => {
            if (utils_1.NodePackageUtils.isNodeProject(subProject)) {
                subProject.deps.all
                    .filter((dep) => nodeSubProjectNames.has(dep.name))
                    .forEach((d) => {
                    switch (d.type) {
                        case projen_1.DependencyType.RUNTIME:
                            subProject.addDeps(`${d.name}@workspace:*`);
                            break;
                        case projen_1.DependencyType.BUILD:
                            subProject.addDevDeps(`${d.name}@workspace:*`);
                            break;
                        case projen_1.DependencyType.PEER:
                            subProject.addPeerDeps(`${d.name}@workspace:*`);
                            break;
                        default:
                            console.warn(`Cannot update local dependency due to unsupported type: ${d.type}`);
                    }
                });
            }
        });
    }
}
exports.MonorepoTsProject = MonorepoTsProject;
_a = JSII_RTTI_SYMBOL_1;
MonorepoTsProject[_a] = { fqn: "@aws/pdk.monorepo.MonorepoTsProject", version: "0.26.14" };
/**
 * Gets bundled dependencies for a given project
 */
function getBundledDeps(project) {
    return project.deps.all.filter((dep) => dep.type === projen_1.DependencyType.BUNDLED);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9ub3JlcG8tdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtb25vcmVwby10cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBO3NDQUNzQztBQUN0Qyw2QkFBNkI7QUFDN0IsbUNBT2dCO0FBRWhCLHNEQUF3RTtBQUV4RSxzREFBMEQ7QUFDMUQseURBQThDO0FBRTlDLHNFQUkwQztBQUMxQyw0REFBd0Q7QUFFeEQsMEVBRzRDO0FBRTVDLHVDQUE2RDtBQThHN0Q7Ozs7O0dBS0c7QUFDSCxNQUFhLGlCQUNYLFNBQVEsOEJBQWlCO0lBa0J6QixZQUFZLE9BQWlDO1FBQzNDLE1BQU0sb0JBQW9CLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixJQUFJLE1BQU0sQ0FBQztRQUNwRSxLQUFLLENBQUM7WUFDSixHQUFHLE9BQU87WUFDVixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sSUFBSSxLQUFLO1lBQy9CLE9BQU8sRUFBRSxPQUFPLENBQUMsT0FBTyxJQUFJLEtBQUs7WUFDakMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxjQUFjO2dCQUNuQyxDQUFDLENBQUMsd0JBQWdCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDO2dCQUN6RCxDQUFDLENBQUMsU0FBUztZQUNiLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUSxJQUFJLElBQUk7WUFDbEMsVUFBVSxFQUFFLElBQUk7WUFDaEIsT0FBTyxFQUFFLE9BQU8sQ0FBQyxPQUFPLElBQUksS0FBSztZQUNqQyxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksSUFBSSxLQUFLO1lBQzNCLFVBQVUsRUFBRSxLQUFLLEVBQUUsc0NBQXNDO1lBQ3pELFNBQVMsRUFBRSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUNqRCxvQkFBb0I7WUFDcEIsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhLElBQUk7Z0JBQ3RDLElB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QUFjLENBQUMsT0FBTzs0QkFDekIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLGNBQWMsQ0FBQyxDQUFDOzRCQUM1QyxNQUFNO3dCQUNSLEtBQUssdUJBQWMsQ0FBQyxLQUFLOzRCQUN2QixVQUFVLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksY0FBYyxDQUFDLENBQUM7NEJBQy9DLE1BQU07d0JBQ1IsS0FBSyx1QkFBYyxDQUFDLElBQUk7NEJBQ3RCLFVBQVUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxjQUFjLENBQUMsQ0FBQzs0QkFDaEQsTUFBTTt3QkFDUjs0QkFDRSxPQUFPLENBQUMsSUFBSSxDQUNWLDJEQUEyRCxDQUFDLENBQUMsSUFBSSxFQUFFLENBQ3BFLENBQUM7b0JBQ04sQ0FBQztnQkFDSCxDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7O0FBcG9CSCw4Q0Fxb0JDOzs7QUFFRDs7R0FFRztBQUNILFNBQVMsY0FBYyxDQUFDLE9BQWdCO0lBQ3RDLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLHVCQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDL0UsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBDb3B5cmlnaHQgW0FtYXpvbi5jb21dKGh0dHA6Ly9hbWF6b24uY29tLyksIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG5TUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMCAqL1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHtcbiAgRGVwZW5kZW5jeSxcbiAgRGVwZW5kZW5jeVR5cGUsXG4gIEpzb25GaWxlLFxuICBQcm9qZWN0LFxuICBUYXNrLFxuICBZYW1sRmlsZSxcbn0gZnJvbSBcInByb2plblwiO1xuaW1wb3J0IHsgSmF2YVByb2plY3QgfSBmcm9tIFwicHJvamVuL2xpYi9qYXZhXCI7XG5pbXBvcnQgeyBOb2RlUGFja2FnZU1hbmFnZXIsIE5vZGVQcm9qZWN0IH0gZnJvbSBcInByb2plbi9saWIvamF2YXNjcmlwdFwiO1xuaW1wb3J0IHsgUHl0aG9uUHJvamVjdCB9IGZyb20gXCJwcm9qZW4vbGliL3B5dGhvblwiO1xuaW1wb3J0IHsgVHlwZVNjcmlwdFByb2plY3QgfSBmcm9tIFwicHJvamVuL2xpYi90eXBlc2NyaXB0XCI7XG5pbXBvcnQgeyBTeW5jcGFjayB9IGZyb20gXCIuL3N5bmNwYWNrLW9wdGlvbnNcIjtcbmltcG9ydCB7IFR5cGVTY3JpcHRQcm9qZWN0T3B0aW9ucyB9IGZyb20gXCIuL3R5cGVzY3JpcHQtcHJvamVjdC1vcHRpb25zXCI7XG5pbXBvcnQge1xuICBOeENvbmZpZ3VyYXRvcixcbiAgSU54UHJvamVjdENvcmUsXG4gIExpY2Vuc2VPcHRpb25zLFxufSBmcm9tIFwiLi4vLi4vY29tcG9uZW50cy9ueC1jb25maWd1cmF0b3JcIjtcbmltcG9ydCB7IE54UHJvamVjdCB9IGZyb20gXCIuLi8uLi9jb21wb25lbnRzL254LXByb2plY3RcIjtcbmltcG9ydCB7IE54V29ya3NwYWNlIH0gZnJvbSBcIi4uLy4uL2NvbXBvbmVudHMvbngtd29ya3NwYWNlXCI7XG5pbXBvcnQge1xuICBERUZBVUxUX1BST0pFTl9WRVJTSU9OLFxuICBzeW5jUHJvamVuVmVyc2lvbnMsXG59IGZyb20gXCIuLi8uLi9jb21wb25lbnRzL3Byb2plbi1kZXBlbmRlbmN5XCI7XG5pbXBvcnQgeyBOeCB9IGZyb20gXCIuLi8uLi9ueC10eXBlc1wiO1xuaW1wb3J0IHsgTm9kZVBhY2thZ2VVdGlscywgUHJvamVjdFV0aWxzIH0gZnJvbSBcIi4uLy4uL3V0aWxzXCI7XG5cbi8qKlxuICogV29ya3NwYWNlIGNvbmZpZ3VyYXRpb25zLlxuICpcbiAqIEBzZWUgaHR0cHM6Ly9jbGFzc2ljLnlhcm5wa2cuY29tL2xhbmcvZW4vZG9jcy93b3Jrc3BhY2VzL1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFdvcmtzcGFjZUNvbmZpZyB7XG4gIC8qKlxuICAgKiBZYXJuIHdvcmtzcGFjZSBjb25maWdcbiAgICovXG4gIHJlYWRvbmx5IHlhcm4/OiBZYXJuV29ya3NwYWNlQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBMaW5rcyBhbGwgbG9jYWwgd29ya3NwYWNlIHByb2plY3QgYmlucyBzbyB0aGV5IGNhbiBiZSB1c2VkIGZvciBsb2NhbCBkZXZlbG9wbWVudC5cbiAgICpcbiAgICogUGFja2FnZSBiaW5zIGFyZSBvbmx5IGxpbmtlZCB3aGVuIGluc3RhbGxlZCBmcm9tIHRoZSByZWdpc3RyeSwgaG93ZXZlciBpdCBpcyB2ZXJ5IHVzZWZ1bFxuICAgKiBmb3IgbW9ub3JlcG8gZGV2ZWxvcG1lbnQgdG8gYWxzbyB1dGlsaXplIHRoZXNlIGJpbiBzY3JpcHRzLiBXaGVuIGVuYWJsZWQsIHRoaXMgZmxhZyB3aWxsXG4gICAqIHJlY3Vyc2l2ZWx5IGxpbmsgYWxsIGJpbnMgZnJvbSBwYWNrYWdlcy5qc29uIGZpbGVzIHRvIHRoZSByb290IG5vZGVfbW9kdWxlcy8uYmluLlxuICAgKi9cbiAgcmVhZG9ubHkgbGlua0xvY2FsV29ya3NwYWNlQmlucz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgYWRkaXRpb25hbCBwYWNrYWdlIGdsb2JzIHRvIGluY2x1ZGUgaW4gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQWxsIHBhY2thZ2VzIHdoaWNoIGFyZSBwYXJlbnRlZCBieSB0aGUgbW9ub3JlcG8gYXJlIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIHdvcmtzcGFjZSwgYnV0IHlvdSBjYW4gdXNlIHRoaXNcbiAgICogcHJvcGVydHkgdG8gc3BlY2lmeSBhbnkgYWRkaXRpb25hbCBwYXRocyB0byBwYWNrYWdlcyB3aGljaCBtYXkgbm90IGJlIG1hbmFnZWQgYnkgcHJvamVuLlxuICAgKi9cbiAgcmVhZG9ubHkgYWRkaXRpb25hbFBhY2thZ2VzPzogc3RyaW5nW107XG59XG5cbi8qKlxuICogWWFybiByZWxhdGVkIHdvcmtzcGFjZSBjb25maWdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBZYXJuV29ya3NwYWNlQ29uZmlnIHtcbiAgLyoqXG4gICAqIExpc3Qgb2YgcGFja2FnZSBnbG9icyB0byBleGNsdWRlIGZyb20gaG9pc3RpbmcgaW4gdGhlIHdvcmtzcGFjZS5cbiAgICpcbiAgICogQHNlZSBodHRwczovL2NsYXNzaWMueWFybnBrZy5jb20vYmxvZy8yMDE4LzAyLzE1L25vaG9pc3QvXG4gICAqL1xuICByZWFkb25seSBub0hvaXN0Pzogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIERpc2FibGUgYXV0b21hdGljYWxseSBhcHBseWluZyBgbm9Ib2lzdGAgbG9naWMgZm9yIGFsbCBzdWItcHJvamVjdCBcImJ1bmRsZWREZXBlbmRlbmNpZXNcIi5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGRpc2FibGVOb0hvaXN0QnVuZGxlZD86IGJvb2xlYW47XG59XG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBmb3IgTW9ub3JlcG8gVXBncmFkZSBEZXBzIHRhc2suXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTW9ub3JlcG9VcGdyYWRlRGVwc09wdGlvbnMge1xuICAvKipcbiAgICogTmFtZSBvZiB0aGUgdGFzayB0byBjcmVhdGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IHVwZ3JhZGUtZGVwc1xuICAgKi9cbiAgcmVhZG9ubHkgdGFza05hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFN5bmNwYWNrIGNvbmZpZ3VyYXRpb24uXG4gICAqXG4gICAqIE5vIG1lcmdpbmcgaXMgcGVyZm9ybWVkIGFuZCBhcyBzdWNoIGEgY29tcGxldGUgc3luY3BhY2tDb25maWcgaXMgcmVxdWlyZWQgaWYgc3VwcGxpZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IFN5bmNwYWNrLkRFRkFVTFRfQ09ORklHXG4gICAqL1xuICByZWFkb25seSBzeW5jcGFja0NvbmZpZz86IFN5bmNwYWNrLlN5bmNwYWNrQ29uZmlnO1xufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgdGhlIE1vbm9yZXBvVHNQcm9qZWN0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIE1vbm9yZXBvVHNQcm9qZWN0T3B0aW9ucyBleHRlbmRzIFR5cGVTY3JpcHRQcm9qZWN0T3B0aW9ucyB7XG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIGZvciB3b3Jrc3BhY2UuXG4gICAqL1xuICByZWFkb25seSB3b3Jrc3BhY2VDb25maWc/OiBXb3Jrc3BhY2VDb25maWc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gaW5jbHVkZSBhbiB1cGdyYWRlLWRlcHMgdGFzayBhdCB0aGUgcm9vdCBvZiB0aGUgbW9ub3JlcG8gd2hpY2ggd2lsbCB1cGdyYWRlIGFsbCBkZXBlbmRlbmNpZXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IG1vbm9yZXBvVXBncmFkZURlcHM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBNb25vcmVwbyBVcGdyYWRlIERlcHMgb3B0aW9ucy5cbiAgICpcbiAgICogVGhpcyBpcyBvbmx5IHVzZWQgaWYgbW9ub3JlcG9VcGdyYWRlRGVwcyBpcyB0cnVlLlxuICAgKlxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWRcbiAgICovXG4gIHJlYWRvbmx5IG1vbm9yZXBvVXBncmFkZURlcHNPcHRpb25zPzogTW9ub3JlcG9VcGdyYWRlRGVwc09wdGlvbnM7XG5cbiAgLyoqXG4gICAqIERpc2FibGUgbm9kZSB3YXJuaW5ncyBmcm9tIGJlaW5nIGVtaXR0ZWQgZHVyaW5nIGJ1aWxkIHRhc2tzXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBkaXNhYmxlTm9kZVdhcm5pbmdzPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogRGVmYXVsdCBsaWNlbnNlIHRvIGFwcGx5IHRvIGFsbCBQREsgbWFuYWdlZCBwYWNrYWdlcy5cbiAgICpcbiAgICogQGRlZmF1bHQgQXBhY2hlLTIuMFxuICAgKi9cbiAgcmVhZG9ubHkgbGljZW5zZU9wdGlvbnM/OiBMaWNlbnNlT3B0aW9ucztcbn1cblxuLyoqXG4gKiBUaGlzIHByb2plY3QgdHlwZSB3aWxsIGJvb3RzdHJhcCBhIG1vbm9yZXBvIHdpdGggc3VwcG9ydCBmb3IgcG9seWdvdFxuICogYnVpbGRzLCBidWlsZCBjYWNoaW5nLCBkZXBlbmRlbmN5IGdyYXBoIHZpc3VhbGl6YXRpb24gYW5kIG11Y2ggbW9yZS5cbiAqXG4gKiBAcGppZCBtb25vcmVwby10c1xuICovXG5leHBvcnQgY2xhc3MgTW9ub3JlcG9Uc1Byb2plY3RcbiAgZXh0ZW5kcyBUeXBlU2NyaXB0UHJvamVjdFxuICBpbXBsZW1lbnRzIElOeFByb2plY3RDb3JlXG57XG4gIC8qKlxuICAgKiBWZXJzaW9uIG9mIHByb2plbiB1c2VkIGJ5IHRoZSBtb25vcmVwbyBhbmQgaXRzIHN1YnByb2plY3RzXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IHByb2plblZlcnNpb246IHN0cmluZztcblxuICAvLyBpbW11dGFibGUgZGF0YSBzdHJ1Y3R1cmVzXG4gIHByaXZhdGUgcmVhZG9ubHkgd29ya3NwYWNlQ29uZmlnPzogV29ya3NwYWNlQ29uZmlnO1xuICBwcml2YXRlIHJlYWRvbmx5IHdvcmtzcGFjZVBhY2thZ2VzOiBzdHJpbmdbXTtcblxuICBwdWJsaWMgcmVhZG9ubHkgbnhDb25maWd1cmF0b3I6IE54Q29uZmlndXJhdG9yO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX29wdGlvbnM6IE1vbm9yZXBvVHNQcm9qZWN0T3B0aW9ucztcblxuICBwcml2YXRlIHN1Yk5vZGVQcm9qZWN0UmVzb2x2ZXM6IEFycmF5PCgpID0+IGJvb2xlYW4+ID0gW107XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogTW9ub3JlcG9Uc1Byb2plY3RPcHRpb25zKSB7XG4gICAgY29uc3QgZGVmYXVsdFJlbGVhc2VCcmFuY2ggPSBvcHRpb25zLmRlZmF1bHRSZWxlYXNlQnJhbmNoID8/IFwibWFpblwiO1xuICAgIHN1cGVyKHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICBnaXRodWI6IG9wdGlvbnMuZ2l0aHViID8/IGZhbHNlLFxuICAgICAgcGFja2FnZTogb3B0aW9ucy5wYWNrYWdlID8/IGZhbHNlLFxuICAgICAgcHJvamVuQ29tbWFuZDogb3B0aW9ucy5wYWNrYWdlTWFuYWdlclxuICAgICAgICA/IE5vZGVQYWNrYWdlVXRpbHMuY29tbWFuZC5wcm9qZW4ob3B0aW9ucy5wYWNrYWdlTWFuYWdlcilcbiAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBwcmV0dGllcjogb3B0aW9ucy5wcmV0dGllciA/PyB0cnVlLFxuICAgICAgcHJvamVucmNUczogdHJ1ZSxcbiAgICAgIHJlbGVhc2U6IG9wdGlvbnMucmVsZWFzZSA/PyBmYWxzZSxcbiAgICAgIGplc3Q6IG9wdGlvbnMuamVzdCA/PyBmYWxzZSxcbiAgICAgIHNhbXBsZUNvZGU6IGZhbHNlLCAvLyByb290IHNob3VsZCBuZXZlciBoYXZlIHNhbXBsZSBjb2RlLFxuICAgICAgZ2l0aWdub3JlOiBbXCIudG1wXCIsIC4uLihvcHRpb25zLmdpdGlnbm9yZSA/PyBbXSldLFxuICAgICAgZGVmYXVsdFJlbGVhc2VCcmFuY2gsXG4gICAgICBlc2xpbnRPcHRpb25zOiBvcHRpb25zLmVzbGludE9wdGlvbnMgPz8ge1xuICAgICAgICBkaXJzOiBbXCIuXCJdLFxuICAgICAgICBpZ25vcmVQYXR0ZXJuczogW1wicGFja2FnZXMvKiovKi4qXCJdLFxuICAgICAgfSxcbiAgICAgIHRzY29uZmlnOiBvcHRpb25zLnRzY29uZmlnID8/IHtcbiAgICAgICAgY29tcGlsZXJPcHRpb25zOiB7XG4gICAgICAgICAgcm9vdERpcjogXCIuXCIsXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IFtcIioqLyoudHNcIiwgXCIucHJvamVucmMudHNcIl0sXG4gICAgICB9LFxuICAgICAgcGVlckRlcHM6IFtcIm54QF4xOVwiLCAuLi4ob3B0aW9ucy5wZWVyRGVwcyB8fCBbXSldLFxuICAgICAgZGV2RGVwczogW1wibnhAXjE5XCIsIFwiQGF3cy9wZGtAXjBcIiwgLi4uKG9wdGlvbnMuZGV2RGVwcyB8fCBbXSldLFxuICAgICAgZGVwczogW1xuICAgICAgICBcImF3cy1jZGstbGliXCIsXG4gICAgICAgIFwiY2RrLW5hZ1wiLFxuICAgICAgICBcIkBhd3MtY2RrL2F3cy1jb2duaXRvLWlkZW50aXR5cG9vbC1hbHBoYUBsYXRlc3RcIixcbiAgICAgICAgLi4uKG9wdGlvbnMuZGVwcyB8fCBbXSksXG4gICAgICBdLFxuICAgICAgcHJvamVuVmVyc2lvbjogb3B0aW9ucy5wcm9qZW5WZXJzaW9uID8/IERFRkFVTFRfUFJPSkVOX1ZFUlNJT04sXG4gICAgfSk7XG5cbiAgICB0aGlzLnByb2plblZlcnNpb24gPSBvcHRpb25zLnByb2plblZlcnNpb24gPz8gREVGQVVMVF9QUk9KRU5fVkVSU0lPTjtcblxuICAgIHRoaXMubnhDb25maWd1cmF0b3IgPSBuZXcgTnhDb25maWd1cmF0b3IodGhpcywge1xuICAgICAgZGVmYXVsdFJlbGVhc2VCcmFuY2gsXG4gICAgICBsaWNlbnNlT3B0aW9uczogb3B0aW9ucy5saWNlbnNlT3B0aW9ucyxcbiAgICB9KTtcbiAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcblxuICAgIC8vIGVuZ2luZXNcbiAgICB0aGlzLnBhY2thZ2UuYWRkRW5naW5lKFwibm9kZVwiLCBcIj49MTZcIik7XG4gICAgdGhpcy5wYWNrYWdlLnNldFNjcmlwdChcbiAgICAgIFwiaW5zdGFsbDpjaVwiLFxuICAgICAgIXRoaXMuZWplY3RlZFxuICAgICAgICA/IE5vZGVQYWNrYWdlVXRpbHMuY29tbWFuZC5leGVjKFxuICAgICAgICAgICAgdGhpcy5wYWNrYWdlLnBhY2thZ2VNYW5hZ2VyLFxuICAgICAgICAgICAgXCJwcm9qZW4gaW5zdGFsbDpjaVwiXG4gICAgICAgICAgKVxuICAgICAgICA6IFwic2NyaXB0cy9ydW4tdGFzayBpbnN0YWxsOmNpXCJcbiAgICApO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhY2thZ2UucGFja2FnZU1hbmFnZXIpIHtcbiAgICAgIGNhc2UgTm9kZVBhY2thZ2VNYW5hZ2VyLkJVTjoge1xuICAgICAgICB0aGlzLnBhY2thZ2UuYWRkRW5naW5lKFwiYnVuXCIsIFwiPj0xXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgTm9kZVBhY2thZ2VNYW5hZ2VyLlBOUE06IHtcbiAgICAgICAgLy8gaHR0cHM6Ly9wbnBtLmlvL3BhY2thZ2VfanNvblxuICAgICAgICB0aGlzLnBhY2thZ2UuYWRkRW5naW5lKFwicG5wbVwiLCBcIj49OFwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIE5vZGVQYWNrYWdlTWFuYWdlci5ZQVJOX0NMQVNTSUM6XG4gICAgICBjYXNlIE5vZGVQYWNrYWdlTWFuYWdlci5ZQVJOOiB7XG4gICAgICAgIHRoaXMucGFja2FnZS5hZGRFbmdpbmUoXCJ5YXJuXCIsIFwiPj0xIDwyXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgTm9kZVBhY2thZ2VNYW5hZ2VyLllBUk5fQkVSUlk6XG4gICAgICBjYXNlIE5vZGVQYWNrYWdlTWFuYWdlci5ZQVJOMjoge1xuICAgICAgICB0aGlzLnBhY2thZ2UuYWRkRW5naW5lKFwieWFyblwiLCBcIj49MlwiKTtcbiAgICAgICAgLy8gWWFybiBCZXJyeSBjYW5ub3QgY2FsbCB5YXJuIGV4ZWMgd2l0aG91dCBhbiBpbnN0YWxsIGZpcnN0ISBVc2UgTlBYIGluc3RlYWQuXG4gICAgICAgIHRoaXMucGFja2FnZS5zZXRTY3JpcHQoXG4gICAgICAgICAgXCJpbnN0YWxsOmNpXCIsXG4gICAgICAgICAgIXRoaXMuZWplY3RlZFxuICAgICAgICAgICAgPyBOb2RlUGFja2FnZVV0aWxzLmNvbW1hbmQuZXhlYyhcbiAgICAgICAgICAgICAgICBOb2RlUGFja2FnZU1hbmFnZXIuTlBNLFxuICAgICAgICAgICAgICAgIFwicHJvamVuIGluc3RhbGw6Y2lcIlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICA6IFwic2NyaXB0cy9ydW4tdGFzayBpbnN0YWxsOmNpXCJcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5wYWNrYWdlLnNldFNjcmlwdChcbiAgICAgICAgICBcImluc3RhbGxcIixcbiAgICAgICAgICAhdGhpcy5lamVjdGVkXG4gICAgICAgICAgICA/IE5vZGVQYWNrYWdlVXRpbHMuY29tbWFuZC5leGVjKFxuICAgICAgICAgICAgICAgIE5vZGVQYWNrYWdlTWFuYWdlci5OUE0sXG4gICAgICAgICAgICAgICAgXCJwcm9qZW4gaW5zdGFsbFwiXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIDogXCJzY3JpcHRzL3J1bi10YXNrIGluc3RhbGxcIlxuICAgICAgICApO1xuICAgICAgICB0aGlzLmdpdGlnbm9yZS5hZGRQYXR0ZXJucyhcbiAgICAgICAgICBcIi55YXJuLypcIixcbiAgICAgICAgICBcIi5wbnAuY2pzXCIsXG4gICAgICAgICAgXCIhLnlhcm4vcmVsZWFzZXNcIixcbiAgICAgICAgICBcIiEueWFybi9wbHVnaW5zXCJcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIE5vZGVQYWNrYWdlTWFuYWdlci5OUE06IHtcbiAgICAgICAgLy8gQWxsb3cgb2xkZXIgdmVyc2lvbnMgb2YgcGVlciBkZXBzIHRvIHJlc29sdiBjb21wYXRpYmlsaXR5IGlzc3Vlc1xuICAgICAgICB0aGlzLnRhc2tzLnRyeUZpbmQoXCJpbnN0YWxsXCIpPy5yZXNldChcIm5wbSBpbnN0YWxsIC0tbGVnYWN5LXBlZXItZGVwc1wiKTtcbiAgICAgICAgdGhpcy50YXNrcy50cnlGaW5kKFwiaW5zdGFsbDpjaVwiKT8ucmVzZXQoXCJucG0gY2kgLS1sZWdhY3ktcGVlci1kZXBzXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLndvcmtzcGFjZUNvbmZpZyA9IG9wdGlvbnMud29ya3NwYWNlQ29uZmlnO1xuICAgIHRoaXMud29ya3NwYWNlUGFja2FnZXMgPSBvcHRpb25zLndvcmtzcGFjZUNvbmZpZz8uYWRkaXRpb25hbFBhY2thZ2VzID8/IFtdO1xuXG4gICAgLy8gTmV2ZXIgcHVibGlzaCBhIG1vbm9yZXBvIHJvb3QgcGFja2FnZS5cbiAgICB0aGlzLnBhY2thZ2UuYWRkRmllbGQoXCJwcml2YXRlXCIsIHRydWUpO1xuXG4gICAgLy8gQWRkIGFsaWFzIHRhc2sgZm9yIFwicHJvamVuXCIgdG8gc3ludGhlc2l6ZSB3b3Jrc3BhY2VcbiAgICAhdGhpcy5lamVjdGVkICYmXG4gICAgICB0aGlzLnBhY2thZ2Uuc2V0U2NyaXB0KFxuICAgICAgICBcInN5bnRoLXdvcmtzcGFjZVwiLFxuICAgICAgICBOb2RlUGFja2FnZVV0aWxzLmNvbW1hbmQucHJvamVuKHRoaXMucGFja2FnZS5wYWNrYWdlTWFuYWdlcilcbiAgICAgICk7XG5cbiAgICAvLyBNYXAgdGFza3MgdG8gbnggcnVuLW1hbnlcbiAgICBpZiAob3B0aW9ucy5zY3JpcHRzID09IG51bGwgfHwgb3B0aW9ucy5zY3JpcHRzLmJ1aWxkID09IG51bGwpIHtcbiAgICAgIHRoaXMubnhDb25maWd1cmF0b3IuX292ZXJyaWRlTnhCdWlsZFRhc2soXG4gICAgICAgIHRoaXMuYnVpbGRUYXNrLFxuICAgICAgICB7IHRhcmdldDogXCJidWlsZFwiIH0sXG4gICAgICAgIHsgZm9yY2U6IHRydWUgfVxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuc2NyaXB0cyA9PSBudWxsIHx8IG9wdGlvbnMuc2NyaXB0c1tcInByZS1jb21waWxlXCJdID09IG51bGwpIHtcbiAgICAgIHRoaXMubnhDb25maWd1cmF0b3IuX292ZXJyaWRlTnhCdWlsZFRhc2sodGhpcy5wcmVDb21waWxlVGFzaywge1xuICAgICAgICB0YXJnZXQ6IFwicHJlLWNvbXBpbGVcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zY3JpcHRzID09IG51bGwgfHwgb3B0aW9ucy5zY3JpcHRzLmNvbXBpbGUgPT0gbnVsbCkge1xuICAgICAgdGhpcy5ueENvbmZpZ3VyYXRvci5fb3ZlcnJpZGVOeEJ1aWxkVGFzayh0aGlzLmNvbXBpbGVUYXNrLCB7XG4gICAgICAgIHRhcmdldDogXCJjb21waWxlXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuc2NyaXB0cyA9PSBudWxsIHx8IG9wdGlvbnMuc2NyaXB0c1tcInBvc3QtY29tcGlsZVwiXSA9PSBudWxsKSB7XG4gICAgICB0aGlzLm54Q29uZmlndXJhdG9yLl9vdmVycmlkZU54QnVpbGRUYXNrKHRoaXMucG9zdENvbXBpbGVUYXNrLCB7XG4gICAgICAgIHRhcmdldDogXCJwb3N0LWNvbXBpbGVcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zY3JpcHRzID09IG51bGwgfHwgb3B0aW9ucy5zY3JpcHRzLnRlc3QgPT0gbnVsbCkge1xuICAgICAgdGhpcy5ueENvbmZpZ3VyYXRvci5fb3ZlcnJpZGVOeEJ1aWxkVGFzayh0aGlzLnRlc3RUYXNrLCB7XG4gICAgICAgIHRhcmdldDogXCJ0ZXN0XCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuc2NyaXB0cyA9PSBudWxsIHx8IG9wdGlvbnMuc2NyaXB0cy5lc2xpbnQgPT0gbnVsbCkge1xuICAgICAgLy8gVGhlIFByb2plbnJjIGNvbXBvbmVudCBvZiBUeXBlU2NyaXB0UHJvamVjdCByZXNldHMgdGhlIGVzbGludCB0YXNrIGFzIHBhcnQgb2YgcHJlU3ludGhlc2l6ZSB3aGljaCB3b3VsZCB1bmRvXG4gICAgICAvLyBvdXIgY2hhbmdlcywgc28gd2UgZGlzYWJsZSBmdXJ0aGVyIHJlc2V0cy5cbiAgICAgIHRoaXMubnhDb25maWd1cmF0b3IuX292ZXJyaWRlTnhCdWlsZFRhc2soXG4gICAgICAgIHRoaXMuZXNsaW50Py5lc2xpbnRUYXNrLFxuICAgICAgICB7IHRhcmdldDogXCJlc2xpbnRcIiB9LFxuICAgICAgICB7IGRpc2FibGVSZXNldDogdHJ1ZSB9XG4gICAgICApO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zY3JpcHRzID09IG51bGwgfHwgb3B0aW9ucy5zY3JpcHRzLnBhY2thZ2UgPT0gbnVsbCkge1xuICAgICAgdGhpcy5ueENvbmZpZ3VyYXRvci5fb3ZlcnJpZGVOeEJ1aWxkVGFzayh0aGlzLnBhY2thZ2VUYXNrLCB7XG4gICAgICAgIHRhcmdldDogXCJwYWNrYWdlXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuc2NyaXB0cyA9PSBudWxsIHx8IG9wdGlvbnMuc2NyaXB0cy5wcmVwYXJlID09IG51bGwpIHtcbiAgICAgIHRoaXMubnhDb25maWd1cmF0b3IuX292ZXJyaWRlTnhCdWlsZFRhc2soXCJwcmVwYXJlXCIsIHtcbiAgICAgICAgdGFyZ2V0OiBcInByZXBhcmVcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zY3JpcHRzID09IG51bGwgfHwgb3B0aW9ucy5zY3JpcHRzLndhdGNoID09IG51bGwpIHtcbiAgICAgIHRoaXMubnhDb25maWd1cmF0b3IuX292ZXJyaWRlTnhCdWlsZFRhc2sodGhpcy53YXRjaFRhc2ssIHtcbiAgICAgICAgdGFyZ2V0OiBcIndhdGNoXCIsXG4gICAgICAgIG5vQmFpbDogZmFsc2UsXG4gICAgICAgIGlnbm9yZUN5Y2xlczogdHJ1ZSxcbiAgICAgICAgc2tpcENhY2hlOiB0cnVlLFxuICAgICAgICBvdXRwdXRTdHlsZTogXCJzdHJlYW1cIixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMucGFja2FnZS5hZGRQYWNrYWdlUmVzb2x1dGlvbnMoXG4gICAgICBcIkB0eXBlcy9iYWJlbF9fdHJhdmVyc2VANy4xOC4yXCIsXG4gICAgICBcIndyYXAtYW5zaUBeNy4wLjBcIlxuICAgICk7XG5cbiAgICBpZiAodGhpcy5wYWNrYWdlLnBhY2thZ2VNYW5hZ2VyICE9PSBOb2RlUGFja2FnZU1hbmFnZXIuQlVOKSB7XG4gICAgICB0aGlzLnBhY2thZ2UuYWRkUGFja2FnZVJlc29sdXRpb25zKFwiQHprb2NoYW4vanMteWFtbEBucG06anMteWFtbEA0LjEuMFwiKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIHB1YmxpYyBnZXQgbngoKTogTnhXb3Jrc3BhY2Uge1xuICAgIHJldHVybiB0aGlzLm54Q29uZmlndXJhdG9yLm54O1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBwdWJsaWMgZXhlY054UnVuTWFueUNvbW1hbmQob3B0aW9uczogTnguUnVuTWFueU9wdGlvbnMpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm54Q29uZmlndXJhdG9yLmV4ZWNOeFJ1bk1hbnlDb21tYW5kKG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBwdWJsaWMgY29tcG9zZU54UnVuTWFueUNvbW1hbmQob3B0aW9uczogTnguUnVuTWFueU9wdGlvbnMpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRoaXMubnhDb25maWd1cmF0b3IuY29tcG9zZU54UnVuTWFueUNvbW1hbmQob3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIHB1YmxpYyBhZGROeFJ1bk1hbnlUYXNrKG5hbWU6IHN0cmluZywgb3B0aW9uczogTnguUnVuTWFueU9wdGlvbnMpOiBUYXNrIHtcbiAgICByZXR1cm4gdGhpcy5ueENvbmZpZ3VyYXRvci5hZGROeFJ1bk1hbnlUYXNrKG5hbWUsIG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0ZG9jXG4gICAqL1xuICBwdWJsaWMgYWRkSW1wbGljaXREZXBlbmRlbmN5KFxuICAgIGRlcGVuZGVudDogUHJvamVjdCxcbiAgICBkZXBlbmRlZTogc3RyaW5nIHwgUHJvamVjdFxuICApOiB2b2lkIHtcbiAgICB0aGlzLm54Q29uZmlndXJhdG9yLmFkZEltcGxpY2l0RGVwZW5kZW5jeShkZXBlbmRlbnQsIGRlcGVuZGVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdGRvY1xuICAgKi9cbiAgcHVibGljIGFkZEphdmFEZXBlbmRlbmN5KFxuICAgIGRlcGVuZGVudDogSmF2YVByb2plY3QsXG4gICAgZGVwZW5kZWU6IEphdmFQcm9qZWN0XG4gICk6IHZvaWQge1xuICAgIHRoaXMubnhDb25maWd1cmF0b3IuYWRkSmF2YURlcGVuZGVuY3koZGVwZW5kZW50LCBkZXBlbmRlZSk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXRkb2NcbiAgICovXG4gIHB1YmxpYyBhZGRQeXRob25Qb2V0cnlEZXBlbmRlbmN5KFxuICAgIGRlcGVuZGVudDogUHl0aG9uUHJvamVjdCxcbiAgICBkZXBlbmRlZTogUHl0aG9uUHJvamVjdFxuICApOiB2b2lkIHtcbiAgICB0aGlzLm54Q29uZmlndXJhdG9yLmFkZFB5dGhvblBvZXRyeURlcGVuZGVuY3koZGVwZW5kZW50LCBkZXBlbmRlZSk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIG9uZSBvciBtb3JlIGFkZGl0aW9uYWwgcGFja2FnZSBnbG9icyB0byB0aGUgd29ya3NwYWNlLlxuICAgKiBAcGFyYW0gcGFja2FnZUdsb2JzIHBhdGhzIHRvIHRoZSBwYWNrYWdlIHRvIGluY2x1ZGUgaW4gdGhlIHdvcmtzcGFjZSAoZm9yIGV4YW1wbGUgcGFja2FnZXMvbXktcGFja2FnZSlcbiAgICovXG4gIHB1YmxpYyBhZGRXb3Jrc3BhY2VQYWNrYWdlcyguLi5wYWNrYWdlR2xvYnM6IHN0cmluZ1tdKSB7XG4gICAgLy8gQW55IHN1YnByb2plY3RzIHRoYXQgd2VyZSBhZGRlZCBzaW5jZSB0aGUgbGFzdCBjYWxsIHRvIHRoaXMgbWV0aG9kIG5lZWQgdG8gYmUgYWRkZWQgZmlyc3QsIGluIG9yZGVyIHRvIGVuc3VyZVxuICAgIC8vIHdlIGFkZCB0aGUgd29ya3NwYWNlIHBhY2thZ2VzIGluIGEgc2FuZSBvcmRlci5cbiAgICBjb25zdCByZWxhdGl2ZVN1YlByb2plY3RXb3Jrc3BhY2VQYWNrYWdlcyA9IHRoaXMuc29ydGVkU3ViUHJvamVjdHNcbiAgICAgIC5maWx0ZXIoKHMpID0+IFByb2plY3RVdGlscy5pc05hbWVkSW5zdGFuY2VPZihzLCBOb2RlUHJvamVjdCkpXG4gICAgICAubWFwKChwcm9qZWN0KSA9PiBwYXRoLnJlbGF0aXZlKHRoaXMub3V0ZGlyLCBwcm9qZWN0Lm91dGRpcikpO1xuICAgIGNvbnN0IGV4aXN0aW5nV29ya3NwYWNlUGFja2FnZXMgPSBuZXcgU2V0KHRoaXMud29ya3NwYWNlUGFja2FnZXMpO1xuICAgIHRoaXMud29ya3NwYWNlUGFja2FnZXMucHVzaChcbiAgICAgIC4uLnJlbGF0aXZlU3ViUHJvamVjdFdvcmtzcGFjZVBhY2thZ2VzLmZpbHRlcihcbiAgICAgICAgKHBrZykgPT4gIWV4aXN0aW5nV29ya3NwYWNlUGFja2FnZXMuaGFzKHBrZylcbiAgICAgIClcbiAgICApO1xuXG4gICAgLy8gQWRkIHRoZSBhZGRpdGlvbmFsIHBhY2thZ2VzIG5leHRcbiAgICB0aGlzLndvcmtzcGFjZVBhY2thZ2VzLnB1c2goLi4ucGFja2FnZUdsb2JzKTtcbiAgfVxuXG4gIC8qKiBHZXQgY29uc2lzdGVudGx5IHNvcnRlZCBsaXN0IG9mIHN1YnByb2plY3RzICovXG4gIHB1YmxpYyBnZXQgc29ydGVkU3ViUHJvamVjdHMoKTogUHJvamVjdFtdIHtcbiAgICByZXR1cm4gdGhpcy5zdWJwcm9qZWN0c1xuICAgICAgLnNsaWNlKClcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgc3ltYm9saWMgbGlua3MgdG8gYWxsIGxvY2FsIHdvcmtzcGFjZSBiaW5zLiBUaGlzIGVuYWJsZXMgdGhlIHVzYWdlIG9mIGJpbnMgdGhlIHNhbWVcbiAgICogd2F5IGFzIGNvbnN1bWVycyBvZiB0aGUgcGFja2FnZXMgaGF2ZSB3aGVuIGluc3RhbGxpbmcgZnJvbSB0aGUgcmVnaXN0cnkuXG4gICAqL1xuICBwcm90ZWN0ZWQgbGlua0xvY2FsV29ya3NwYWNlQmlucygpOiB2b2lkIHtcbiAgICBjb25zdCBiaW5zOiBbc3RyaW5nLCBzdHJpbmddW10gPSBbXTtcblxuICAgIHRoaXMuc3VicHJvamVjdHMuZm9yRWFjaCgoc3ViUHJvamVjdCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBQcm9qZWN0VXRpbHMuaXNOYW1lZEluc3RhbmNlT2Yoc3ViUHJvamVjdCwgTm9kZVByb2plY3QpICYmXG4gICAgICAgIHN1YlByb2plY3QubmFtZSAhPT0gXCJAYXdzL3Bka1wiXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgcGtnQmluczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9XG4gICAgICAgICAgc3ViUHJvamVjdC5wYWNrYWdlLm1hbmlmZXN0LmJpbigpIHx8IHt9O1xuICAgICAgICBiaW5zLnB1c2goXG4gICAgICAgICAgLi4uT2JqZWN0LmVudHJpZXMocGtnQmlucykubWFwKChbY21kLCBiaW5dKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNvbHZlZEJpbiA9IHBhdGguam9pbihcbiAgICAgICAgICAgICAgXCIkUFdEXCIsXG4gICAgICAgICAgICAgIHBhdGgucmVsYXRpdmUodGhpcy5vdXRkaXIsIHN1YlByb2plY3Qub3V0ZGlyKSxcbiAgICAgICAgICAgICAgYmluXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIFtjbWQsIHJlc29sdmVkQmluXSBhcyBbc3RyaW5nLCBzdHJpbmddO1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBsaW5rVGFzayA9IHRoaXMuYWRkVGFzayhcIndvcmtzcGFjZTpiaW46bGlua1wiLCB7XG4gICAgICBzdGVwczogYmlucy5tYXAoKFtjbWQsIGJpbl0pID0+ICh7XG4gICAgICAgIGV4ZWM6IGBsbiAtcyAke2Jpbn0gJHtOb2RlUGFja2FnZVV0aWxzLmNvbW1hbmQuYmluKFxuICAgICAgICAgIHRoaXMucGFja2FnZS5wYWNrYWdlTWFuYWdlcixcbiAgICAgICAgICBjbWRcbiAgICAgICAgKX0gJj4vZGV2L251bGw7IGV4aXQgMDtgLFxuICAgICAgfSkpLFxuICAgIH0pO1xuXG4gICAgKHRoaXMudGFza3MudHJ5RmluZChcInByZXBhcmVcIikgfHwgdGhpcy5hZGRUYXNrKFwicHJlcGFyZVwiKSkuc3Bhd24obGlua1Rhc2spO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRVcGdyYWRlRGVwc1Rhc2soKSB7XG4gICAgaWYgKHRoaXMuX29wdGlvbnMubW9ub3JlcG9VcGdyYWRlRGVwcyAhPT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuYWRkRGV2RGVwcyhcIm5wbS1jaGVjay11cGRhdGVzXCIsIFwic3luY3BhY2tAXjEzXCIpO1xuXG4gICAgICBjb25zdCB1cGdyYWRlRGVwc1Rhc2sgPSB0aGlzLmFkZFRhc2soXG4gICAgICAgIHRoaXMuX29wdGlvbnMubW9ub3JlcG9VcGdyYWRlRGVwc09wdGlvbnM/LnRhc2tOYW1lIHx8IFwidXBncmFkZS1kZXBzXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJVcGdyYWRlIGRlcGVuZGVuY2llcyBpbiB0aGUgbW9ub3JlcG9cIixcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIC8vIFJ1biB0aGUgdXBncmFkZSB0YXNrIGZvciBhbnkgbm9uLW5vZGUgc3VicHJvamVjdHNcbiAgICAgIGNvbnN0IG5vbk5vZGVTdWJwcm9qZWN0cyA9IHRoaXMuc3VicHJvamVjdHMuZmlsdGVyKFxuICAgICAgICAocCkgPT4gIU5vZGVQYWNrYWdlVXRpbHMuaXNOb2RlUHJvamVjdChwKVxuICAgICAgKTtcbiAgICAgIGlmIChub25Ob2RlU3VicHJvamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLm54Q29uZmlndXJhdG9yLl9vdmVycmlkZU54QnVpbGRUYXNrKHVwZ3JhZGVEZXBzVGFzaywge1xuICAgICAgICAgIHRhcmdldDogXCJ1cGdyYWRlXCIsXG4gICAgICAgICAgcHJvamVjdHM6IG5vbk5vZGVTdWJwcm9qZWN0cy5tYXAoKHApID0+IHAubmFtZSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm54Q29uZmlndXJhdG9yLl9jb25maWd1cmVQeXRob25TdWJwcm9qZWN0VXBncmFkZURlcHMoXG4gICAgICAgIHRoaXMsXG4gICAgICAgIHVwZ3JhZGVEZXBzVGFza1xuICAgICAgKTtcblxuICAgICAgLy8gVXBncmFkZSBub2RlIHN1YnByb2plY3RzIHRvZ2V0aGVyXG4gICAgICB1cGdyYWRlRGVwc1Rhc2suZXhlYyhcbiAgICAgICAgTm9kZVBhY2thZ2VVdGlscy5jb21tYW5kLmV4ZWMoXG4gICAgICAgICAgdGhpcy5wYWNrYWdlLnBhY2thZ2VNYW5hZ2VyLFxuICAgICAgICAgIFwibnBtLWNoZWNrLXVwZGF0ZXNcIixcbiAgICAgICAgICBcIi0tcmVqZWN0IHByb2plblwiLFxuICAgICAgICAgIFwiLS1kZWVwXCIsXG4gICAgICAgICAgXCItLXJlamVjdFZlcnNpb25cIixcbiAgICAgICAgICBcIjAuMC4wXCIsXG4gICAgICAgICAgXCItdVwiLFxuICAgICAgICAgIFwiLS1kZXBcIixcbiAgICAgICAgICBcInByb2QsZGV2LHBlZXIsb3B0aW9uYWwsYnVuZGxlXCIsXG4gICAgICAgICAgXCItLXRhcmdldD1taW5vclwiXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICAvLyBTeW5jIGRlcGVuZGVuY3kgdmVyc2lvbnMgYWNyb3NzIG5vZGUgc3VicHJvamVjdHNcbiAgICAgIHVwZ3JhZGVEZXBzVGFzay5leGVjKFxuICAgICAgICBOb2RlUGFja2FnZVV0aWxzLmNvbW1hbmQuZXhlYyhcbiAgICAgICAgICB0aGlzLnBhY2thZ2UucGFja2FnZU1hbmFnZXIsXG4gICAgICAgICAgXCJzeW5jcGFja1wiLFxuICAgICAgICAgIFwiZml4LW1pc21hdGNoZXNcIlxuICAgICAgICApXG4gICAgICApO1xuICAgICAgdXBncmFkZURlcHNUYXNrLmV4ZWMoYHJtICR7dGhpcy5wYWNrYWdlLmxvY2tGaWxlfWApO1xuICAgICAgdXBncmFkZURlcHNUYXNrLmV4ZWMoXG4gICAgICAgIE5vZGVQYWNrYWdlVXRpbHMuY29tbWFuZC5pbnN0YWxsKHRoaXMucGFja2FnZS5wYWNrYWdlTWFuYWdlcilcbiAgICAgICk7XG4gICAgICAhdGhpcy5lamVjdGVkICYmXG4gICAgICAgIHVwZ3JhZGVEZXBzVGFzay5leGVjKFxuICAgICAgICAgIE5vZGVQYWNrYWdlVXRpbHMuY29tbWFuZC5leGVjKHRoaXMucGFja2FnZS5wYWNrYWdlTWFuYWdlciwgXCJwcm9qZW5cIilcbiAgICAgICAgKTtcblxuICAgICAgbmV3IEpzb25GaWxlKHRoaXMsIFwiLnN5bmNwYWNrcmMuanNvblwiLCB7XG4gICAgICAgIG9iajpcbiAgICAgICAgICB0aGlzLl9vcHRpb25zLm1vbm9yZXBvVXBncmFkZURlcHNPcHRpb25zPy5zeW5jcGFja0NvbmZpZyB8fFxuICAgICAgICAgIFN5bmNwYWNrLkRFRkFVTFRfQ09ORklHLFxuICAgICAgICByZWFkb25seTogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByZVN5bnRoZXNpemUoKTogdm9pZCB7XG4gICAgdGhpcy5hZGRVcGdyYWRlRGVwc1Rhc2soKTtcblxuICAgIE5vZGVQYWNrYWdlVXRpbHMucmVtb3ZlUHJvamVuU2NyaXB0KHRoaXMpO1xuICAgIHRoaXMubnhDb25maWd1cmF0b3IucHJlU3ludGhlc2l6ZSgpO1xuICAgIHN1cGVyLnByZVN5bnRoZXNpemUoKTtcblxuICAgIGlmICh0aGlzLl9vcHRpb25zLndvcmtzcGFjZUNvbmZpZz8ubGlua0xvY2FsV29ya3NwYWNlQmlucyA9PT0gdHJ1ZSkge1xuICAgICAgdGhpcy5saW5rTG9jYWxXb3Jrc3BhY2VCaW5zKCk7XG4gICAgfVxuXG4gICAgdGhpcy5zdWJwcm9qZWN0cy5mb3JFYWNoKChzdWJQcm9qZWN0KSA9PiB7XG4gICAgICBpZiAoTm9kZVBhY2thZ2VVdGlscy5pc05vZGVQcm9qZWN0KHN1YlByb2plY3QpKSB7XG4gICAgICAgIC8vIFJlbW92ZSBhbnkgc3VicHJvamVjdCAubnBtcmMgZmlsZXMgc2luY2Ugb25seSB0aGUgcm9vdCBvbmUgbWF0dGVyc1xuICAgICAgICBzdWJQcm9qZWN0LnRyeVJlbW92ZUZpbGUoXCIubnBtcmNcIik7XG4gICAgICAgIE5vZGVQYWNrYWdlVXRpbHMucmVtb3ZlUHJvamVuU2NyaXB0KHN1YlByb2plY3QpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc3luY1Byb2plblZlcnNpb25zKHRoaXMuc3VicHJvamVjdHMsIHRoaXMucHJvamVuVmVyc2lvbik7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHN5bnRoKCkge1xuICAgIHRoaXMudmFsaWRhdGVTdWJQcm9qZWN0cygpO1xuICAgIHRoaXMudXBkYXRlV29ya3NwYWNlKCk7XG4gICAgdGhpcy5pbnN0YWxsTm9uTm9kZURlcGVuZGVuY2llcygpO1xuICAgIHRoaXMucmVzb2x2ZUxvY2FsQnVuRGVwZW5kZW5jaWVzKCk7XG5cbiAgICAvLyBEaXNhYmxlIG5vZGUgd2FybmluZ3MgaWYgY29uZmlndXJlZFxuICAgIGlmICh0aGlzLl9vcHRpb25zLmRpc2FibGVOb2RlV2FybmluZ3MpIHtcbiAgICAgIHRoaXMuZGlzYWJsZU5vZGVXYXJuaW5ncygpO1xuICAgIH1cblxuICAgIC8vIFByZXZlbnQgc3ViIE5vZGVQcm9qZWN0IHBhY2thZ2VzIGZyb20gYHBvc3RTeW50aGVzaXNgIHdoaWNoIHdpbGwgY2F1c2UgaW5kaXZpZHVhbC9leHRyYW5lb3VzIGluc3RhbGxzLlxuICAgIC8vIFRoZSB3b3Jrc3BhY2UgcGFja2FnZSBpbnN0YWxsIHdpbGwgaGFuZGxlIGFsbCB0aGUgc3ViIE5vZGVQcm9qZWN0IHBhY2thZ2VzIGF1dG9tYXRpY2FsbHkuXG4gICAgdGhpcy5zdWJwcm9qZWN0cy5mb3JFYWNoKChzdWJQcm9qZWN0KSA9PiB7XG4gICAgICBpZiAoTm9kZVBhY2thZ2VVdGlscy5pc05vZGVQcm9qZWN0KHN1YlByb2plY3QpKSB7XG4gICAgICAgIGNvbnN0IHN1Yk5vZGVQcm9qZWN0OiBOb2RlUHJvamVjdCA9IHN1YlByb2plY3QgYXMgTm9kZVByb2plY3Q7XG4gICAgICAgIGNvbnN0IHN1Yk5vZGVQcm9qZWN0UmVzb2x2ZXIgPVxuICAgICAgICAgIC8vIEB0cy1pZ25vcmUgLSBgcmVzb2x2ZURlcHNBbmRXcml0ZVBhY2thZ2VKc29uYCBpcyBwcml2YXRlXG4gICAgICAgICAgc3ViTm9kZVByb2plY3QucGFja2FnZS5yZXNvbHZlRGVwc0FuZFdyaXRlUGFja2FnZUpzb247XG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBgaW5zdGFsbERlcGVuZGVuY2llc2AgaXMgcHJpdmF0ZVxuICAgICAgICBzdWJOb2RlUHJvamVjdC5wYWNrYWdlLmluc3RhbGxEZXBlbmRlbmNpZXMgPSAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zdWJOb2RlUHJvamVjdFJlc29sdmVzLnB1c2goKCkgPT5cbiAgICAgICAgICAgIHN1Yk5vZGVQcm9qZWN0UmVzb2x2ZXIuYXBwbHkoc3ViTm9kZVByb2plY3QucGFja2FnZSlcbiAgICAgICAgICApO1xuICAgICAgICB9O1xuICAgICAgICAvLyBAdHMtaWdub3JlIC0gYHJlc29sdmVEZXBzQW5kV3JpdGVQYWNrYWdlSnNvbmAgaXMgcHJpdmF0ZVxuICAgICAgICBzdWJOb2RlUHJvamVjdC5wYWNrYWdlLnJlc29sdmVEZXBzQW5kV3JpdGVQYWNrYWdlSnNvbiA9ICgpID0+IHt9O1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5ueENvbmZpZ3VyYXRvci5zeW50aCgpO1xuICAgIHN1cGVyLnN5bnRoKCk7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHBvc3RTeW50aGVzaXplKCk6IHZvaWQge1xuICAgIHN1cGVyLnBvc3RTeW50aGVzaXplKCk7XG4gICAgdGhpcy5yZXNvbHZlU3ViTm9kZVByb2plY3RzKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZSBzdWIgYE5vZGVQYWNrYWdlYCBkZXBlbmRlbmNpZXMuXG4gICAqL1xuICBwcml2YXRlIHJlc29sdmVTdWJOb2RlUHJvamVjdHMoKSB7XG4gICAgaWYgKHRoaXMuc3ViTm9kZVByb2plY3RSZXNvbHZlcy5sZW5ndGgpIHtcbiAgICAgIGlmICghdGhpcy5wYWNrYWdlLmZpbGUuY2hhbmdlZCkge1xuICAgICAgICAvLyBGb3JjZSB3b3Jrc3BhY2UgaW5zdGFsbCBkZXBzIHNpbmNlIGl0IHdvdWxkIG5vdCBoYXZlIGJlZW4gaW52b2tlZCBkdXJpbmcgYHBvc3RTeW50aGVzaXNgLlxuICAgICAgICAvLyBAdHMtaWdub3JlIC0gYGluc3RhbGxEZXBlbmRlbmNpZXNgIGlzIHByaXZhdGVcbiAgICAgICAgdGhpcy5wYWNrYWdlLmluc3RhbGxEZXBlbmRlbmNpZXMoKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbXBsZXRlZFJlc29sdmVzID0gdGhpcy5zdWJOb2RlUHJvamVjdFJlc29sdmVzLm1hcCgocmVzb2x2ZSkgPT5cbiAgICAgICAgcmVzb2x2ZSgpXG4gICAgICApO1xuICAgICAgaWYgKGNvbXBsZXRlZFJlc29sdmVzLnNvbWUoQm9vbGVhbikpIHtcbiAgICAgICAgLy8gSW5kaWNhdGVzIHRoYXQgYSBzdWJwcm9qZWN0IGRlcGVuZGVuY3kgaGFzIGJlZW4gcmVzb2x2ZWQgZnJvbSAnKicsIHNvIHVwZGF0ZSB0aGUgbG9ja2ZpbGUuXG4gICAgICAgIC8vIEB0cy1pZ25vcmUgLSBgaW5zdGFsbERlcGVuZGVuY2llc2AgaXMgcHJpdmF0ZVxuICAgICAgICB0aGlzLnBhY2thZ2UuaW5zdGFsbERlcGVuZGVuY2llcygpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnN1Yk5vZGVQcm9qZWN0UmVzb2x2ZXMgPSBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmVzIHN1YnByb2plY3RzIGRvbid0IGhhdmUgYSBkZWZhdWx0IHRhc2sgYW5kIHRoYXQgYWxsIHBhY2thZ2VzIHVzZSB0aGUgc2FtZSBwYWNrYWdlIG1hbmFnZXIuXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXRlU3ViUHJvamVjdHMoKSB7XG4gICAgdGhpcy5zdWJwcm9qZWN0cy5mb3JFYWNoKChzdWJQcm9qZWN0OiBhbnkpID0+IHtcbiAgICAgIC8vIERpc2FibGUgZGVmYXVsdCB0YXNrIG9uIHN1YnByb2plY3RzIGFzIHRoaXMgaXNuJ3Qgc3VwcG9ydGVkIGluIGEgbW9ub3JlcG9cbiAgICAgIHN1YlByb2plY3QuZGVmYXVsdFRhc2s/LnJlc2V0KCk7XG5cbiAgICAgIGlmIChcbiAgICAgICAgTm9kZVBhY2thZ2VVdGlscy5pc05vZGVQcm9qZWN0KHN1YlByb2plY3QpICYmXG4gICAgICAgIHN1YlByb2plY3QucGFja2FnZS5wYWNrYWdlTWFuYWdlciAhPT0gdGhpcy5wYWNrYWdlLnBhY2thZ2VNYW5hZ2VyXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGAke3N1YlByb2plY3QubmFtZX0gcGFja2FnZU1hbmFnZXIgZG9lcyBub3QgbWF0Y2ggdGhlIG1vbm9yZXBvIHBhY2thZ2VNYW5hZ2VyOiAke3RoaXMucGFja2FnZS5wYWNrYWdlTWFuYWdlcn0uYFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIHN1Ym1vZHVsZSBlbnRyeSB0byB0aGUgYXBwcm9wcmlhdGUgd29ya3NwYWNlIGZpbGUuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZVdvcmtzcGFjZSgpIHtcbiAgICAvLyBBIGZpbmFsIGNhbGwgdG8gYWRkV29ya3NwYWNlUGFja2FnZXMgd2lsbCB1cGRhdGUgdGhlIGxpc3Qgb2Ygd29ya3NwYWNlIHBhY2thZ2VzIHdpdGggYW55IHN1YnByb2plY3RzIHRoYXQgaGF2ZVxuICAgIC8vIG5vdCB5ZXQgYmVlbiBhZGRlZCwgaW4gdGhlIGNvcnJlY3Qgb3JkZXJcbiAgICB0aGlzLmFkZFdvcmtzcGFjZVBhY2thZ2VzKCk7XG5cbiAgICBsZXQgbm9Ib2lzdCA9IHRoaXMud29ya3NwYWNlQ29uZmlnPy55YXJuPy5ub0hvaXN0O1xuICAgIC8vIEF1dG9tYXRpY2FsbHkgYWRkIGFsbCBzdWItcHJvamVjdCBcImJ1bmRsZWREZXBlbmRlbmNpZXNcIiB0byB3b3Jrc3BhY2UgXCJob2hvaXN0XCIsIG90aGVyd2lzZSB0aGV5IGFyZSBub3QgYnVuZGxlZCBpbiBucG0gcGFja2FnZVxuICAgIGlmIChcbiAgICAgIHRoaXMud29ya3NwYWNlQ29uZmlnPy55YXJuPy5kaXNhYmxlTm9Ib2lzdEJ1bmRsZWQgIT09IHRydWUgJiZcbiAgICAgIFtcbiAgICAgICAgTm9kZVBhY2thZ2VNYW5hZ2VyLllBUk4sXG4gICAgICAgIE5vZGVQYWNrYWdlTWFuYWdlci5ZQVJOMixcbiAgICAgICAgTm9kZVBhY2thZ2VNYW5hZ2VyLllBUk5fQkVSUlksXG4gICAgICAgIE5vZGVQYWNrYWdlTWFuYWdlci5ZQVJOX0NMQVNTSUMsXG4gICAgICBdLmluY2x1ZGVzKHRoaXMucGFja2FnZS5wYWNrYWdlTWFuYWdlcilcbiAgICApIHtcbiAgICAgIGNvbnN0IG5vSG9pc3RCdW5kbGVkID0gdGhpcy5zdWJwcm9qZWN0cy5mbGF0TWFwKChzdWIpID0+IHtcbiAgICAgICAgaWYgKFByb2plY3RVdGlscy5pc05hbWVkSW5zdGFuY2VPZihzdWIsIE5vZGVQcm9qZWN0KSkge1xuICAgICAgICAgIHJldHVybiBnZXRCdW5kbGVkRGVwcyhzdWIpLmZsYXRNYXAoKGRlcCkgPT4gW1xuICAgICAgICAgICAgYCR7c3ViLm5hbWV9LyR7ZGVwLm5hbWV9YCxcbiAgICAgICAgICAgIGAke3N1Yi5uYW1lfS8ke2RlcC5uYW1lfS8qYCxcbiAgICAgICAgICBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9KTtcblxuICAgICAgaWYgKG5vSG9pc3RCdW5kbGVkLmxlbmd0aCkge1xuICAgICAgICBub0hvaXN0ID0gWy4uLihub0hvaXN0IHx8IFtdKSwgLi4ubm9Ib2lzdEJ1bmRsZWRdO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFkZCB3b3Jrc3BhY2VzIGZvciBlYWNoIHN1YnByb2plY3RcbiAgICBpZiAodGhpcy5wYWNrYWdlLnBhY2thZ2VNYW5hZ2VyID09PSBOb2RlUGFja2FnZU1hbmFnZXIuUE5QTSkge1xuICAgICAgbmV3IFlhbWxGaWxlKHRoaXMsIFwicG5wbS13b3Jrc3BhY2UueWFtbFwiLCB7XG4gICAgICAgIHJlYWRvbmx5OiB0cnVlLFxuICAgICAgICBvYmo6IHtcbiAgICAgICAgICBwYWNrYWdlczogdGhpcy53b3Jrc3BhY2VQYWNrYWdlcyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnBhY2thZ2UuYWRkRmllbGQoXCJ3b3Jrc3BhY2VzXCIsIHtcbiAgICAgIHBhY2thZ2VzOiB0aGlzLndvcmtzcGFjZVBhY2thZ2VzLFxuICAgICAgbm9ob2lzdDogbm9Ib2lzdCxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnN1cmVzIHRoZSBpbnN0YWxsIHRhc2sgZm9yIG5vbi1ub2RlIHByb2plY3RzIGlzIGV4ZWN1dGVkIHBvc3RpbnN0YWxsLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBpbnN0YWxsTm9uTm9kZURlcGVuZGVuY2llcygpIHtcbiAgICBjb25zdCBpbnN0YWxsUHJvamVjdHMgPSB0aGlzLnN1YnByb2plY3RzLmZpbHRlcihcbiAgICAgIChwcm9qZWN0KSA9PlxuICAgICAgICAhUHJvamVjdFV0aWxzLmlzTmFtZWRJbnN0YW5jZU9mKHByb2plY3QsIE5vZGVQcm9qZWN0KSAmJlxuICAgICAgICBwcm9qZWN0LnRhc2tzLnRyeUZpbmQoXCJpbnN0YWxsXCIpXG4gICAgKTtcblxuICAgIGlmIChpbnN0YWxsUHJvamVjdHMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gVE9ETzogSW5zdGFsbCBlcnJvciBvbiBjbGVhbiByZXBvIGZvciBwb3N0aW5zdGFsbCAoaHR0cHM6Ly9jbG91ZC5ueC5hcHAvcnVucy9NcHRRcjBCeGdGKSAoaHR0cHM6Ly9naXRodWIuY29tL25yd2wvbngvaXNzdWVzLzExMjEwKVxuICAgICAgY29uc3QgcG9zdGluc3RhbGxUYXNrID1cbiAgICAgICAgdGhpcy50YXNrcy50cnlGaW5kKFwicG9zdGluc3RhbGxcIikgPz8gdGhpcy5hZGRUYXNrKFwicG9zdGluc3RhbGxcIik7XG5cbiAgICAgIGNvbnN0IG54UnVuTWFueUluc3RhbGwgPSB0aGlzLmNvbXBvc2VOeFJ1bk1hbnlDb21tYW5kKHtcbiAgICAgICAgdGFyZ2V0OiBcImluc3RhbGxcIixcbiAgICAgICAgcHJvamVjdHM6IGluc3RhbGxQcm9qZWN0cy5tYXAoKHByb2plY3QpID0+IHByb2plY3QubmFtZSksXG4gICAgICAgIHBhcmFsbGVsOiAxLFxuICAgICAgfSk7XG5cbiAgICAgIHBvc3RpbnN0YWxsVGFzay5leGVjKFxuICAgICAgICBOb2RlUGFja2FnZVV0aWxzLmNvbW1hbmQuZXhlYyhcbiAgICAgICAgICB0aGlzLnBhY2thZ2UucGFja2FnZU1hbmFnZXIsXG4gICAgICAgICAgLi4ubnhSdW5NYW55SW5zdGFsbFxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICAvLyBFbnN1cmUgdGhhdCBpbnN0YWxsLXB5IGZvbGxvd3MgZGVwZW5kZW5jeSBvcmRlclxuICAgICAgaW5zdGFsbFByb2plY3RzLmZvckVhY2goKHApID0+IHtcbiAgICAgICAgTnhQcm9qZWN0LmVuc3VyZShwKS5zZXRUYXJnZXQoXCJpbnN0YWxsXCIsIHtcbiAgICAgICAgICBkZXBlbmRzT246IFtcIl5pbnN0YWxsXCJdLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdXBwcmVzcyBOb2RlIHdhcm5pbmdzIGZyb20gYmVpbmcgcHJlc2VudGVkIGluIHRoZSBjb25zb2xlIHdoZW4gcnVubmluZyBidWlsZHMuXG4gICAqL1xuICBwcml2YXRlIGRpc2FibGVOb2RlV2FybmluZ3MoKSB7XG4gICAgdGhpcy50YXNrcy5hZGRFbnZpcm9ubWVudChcIk5PREVfTk9fV0FSTklOR1NcIiwgXCIxXCIpO1xuICAgIHRoaXMuc3VicHJvamVjdHMuZm9yRWFjaCgoc3ViUHJvamVjdCkgPT5cbiAgICAgIHN1YlByb2plY3QudGFza3MuYWRkRW52aXJvbm1lbnQoXCJOT0RFX05PX1dBUk5JTkdTXCIsIFwiMVwiKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZSBhbGwgbG9jYWwgd29ya3NwYWNlIGRlcGVuZGVuY2llcyB0byBrZWVwIGJ1biBoYXBweS5cbiAgICovXG4gIHByaXZhdGUgcmVzb2x2ZUxvY2FsQnVuRGVwZW5kZW5jaWVzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnBhY2thZ2UucGFja2FnZU1hbmFnZXIgIT09IE5vZGVQYWNrYWdlTWFuYWdlci5CVU4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBub2RlU3ViUHJvamVjdE5hbWVzID0gbmV3IFNldChcbiAgICAgIHRoaXMuc3VicHJvamVjdHNcbiAgICAgICAgLmZpbHRlcigocykgPT4gTm9kZVBhY2thZ2VVdGlscy5pc05vZGVQcm9qZWN0KHMpKVxuICAgICAgICAubWFwKChzKSA9PiAocyBhcyBOb2RlUHJvamVjdCkucGFja2FnZS5wYWNrYWdlTmFtZSlcbiAgICApO1xuXG4gICAgdGhpcy5zdWJwcm9qZWN0cy5mb3JFYWNoKChzdWJQcm9qZWN0KSA9PiB7XG4gICAgICBpZiAoTm9kZVBhY2thZ2VVdGlscy5pc05vZGVQcm9qZWN0KHN1YlByb2plY3QpKSB7XG4gICAgICAgIHN1YlByb2plY3QuZGVwcy5hbGxcbiAgICAgICAgICAuZmlsdGVyKChkZXApID0+IG5vZGVTdWJQcm9qZWN0TmFtZXMuaGFzKGRlcC5uYW1lKSlcbiAgICAgICAgICAuZm9yRWFjaCgoZCkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoIChkLnR5cGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBEZXBlbmRlbmN5VHlwZS5SVU5USU1FOlxuICAgICAgICAgICAgICAgIHN1YlByb2plY3QuYWRkRGVwcyhgJHtkLm5hbWV9QHdvcmtzcGFjZToqYCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgRGVwZW5kZW5jeVR5cGUuQlVJTEQ6XG4gICAgICAgICAgICAgICAgc3ViUHJvamVjdC5hZGREZXZEZXBzKGAke2QubmFtZX1Ad29ya3NwYWNlOipgKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSBEZXBlbmRlbmN5VHlwZS5QRUVSOlxuICAgICAgICAgICAgICAgIHN1YlByb2plY3QuYWRkUGVlckRlcHMoYCR7ZC5uYW1lfUB3b3Jrc3BhY2U6KmApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgICAgIGBDYW5ub3QgdXBkYXRlIGxvY2FsIGRlcGVuZGVuY3kgZHVlIHRvIHVuc3VwcG9ydGVkIHR5cGU6ICR7ZC50eXBlfWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogR2V0cyBidW5kbGVkIGRlcGVuZGVuY2llcyBmb3IgYSBnaXZlbiBwcm9qZWN0XG4gKi9cbmZ1bmN0aW9uIGdldEJ1bmRsZWREZXBzKHByb2plY3Q6IFByb2plY3QpOiBEZXBlbmRlbmN5W10ge1xuICByZXR1cm4gcHJvamVjdC5kZXBzLmFsbC5maWx0ZXIoKGRlcCkgPT4gZGVwLnR5cGUgPT09IERlcGVuZGVuY3lUeXBlLkJVTkRMRUQpO1xufVxuIl19